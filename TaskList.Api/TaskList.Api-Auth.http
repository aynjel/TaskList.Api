### TaskList API - HTTP Testing File
### This file contains sample HTTP requests for testing the TaskList API
### 
### API VERSIONING: All endpoints now support v1.0
### - URL Versioning: api/v1/auth/register
### - Header Versioning: X-Api-Version: 1.0
### - Query String: api/auth/register?api-version=1.0
###
### ?? SECURITY NOTE: Refresh tokens are now stored in HTTP-only cookies (not in response body)
### This protects against XSS attacks. Make sure to check browser cookies to see the refreshToken.

# Set the base URL for your API
@baseUrl = https://localhost:7191
@httpUrl = http://localhost:5045

# Variables to store tokens (Access token from response, Refresh token in cookie)
@accessToken = 
@userId = 

###############################################
# Authentication Endpoints (v1)
###############################################

### Register New User (URL Versioning)
# Expected Response:
# {
#   "name": "John Doe",
#   "email": "john.doe@example.com",
#   "token": "eyJhbGc...", // Access token (JWT)
#   "expiresIn": 1800       // 30 minutes in seconds
# }
# Note: Refresh token is set in HTTP-only cookie (not in response)
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "password": "Password123"
}

### Register Another User (for testing)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Jane Smith",
  "email": "jane.smith@example.com",
  "password": "SecurePass456"
}

### Register User - Validation Error (Short Password)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Test User",
  "email": "test@example.com",
  "password": "123"
}

### Register User - Validation Error (Invalid Email)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Test User",
  "email": "invalid-email",
  "password": "Password123"
}

### Register User - Duplicate Email Error
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Duplicate User",
  "email": "john.doe@example.com",
  "password": "Password123"
}

###############################################
# Login
###############################################

### Login with Valid Credentials
# Expected Response:
# {
#   "name": "John Doe",
#   "email": "john.doe@example.com",
#   "token": "eyJhbGc...", // Access token (JWT)
#   "expiresIn": 1800       // 30 minutes
# }
# Note: Refresh token is automatically set in HTTP-only cookie
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "password": "Password123"
}

### Login with Invalid Credentials
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "password": "WrongPassword"
}

###############################################
# Token Refresh
###############################################

### Refresh Access Token
# ? Refresh token is automatically sent from HTTP-only cookie
# ?? This requires the cookie to be present (login first)
# Expected Response:
# {
#   "name": "John Doe",
#   "email": "john.doe@example.com",
#   "token": "eyJhbGc...", // New access token
#   "expiresIn": 1800
# }
POST {{baseUrl}}/api/auth/refresh

###############################################
# Logout
###############################################

### Logout
# Revokes refresh token and clears cookie
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{accessToken}}

###############################################
# Current User
###############################################

### Get Current User Profile
# Replace @accessToken with your access token from login/register response
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{accessToken}}

###############################################
# API Documentation
###############################################

### Get Scalar API Documentation
GET {{baseUrl}}/scalar/v1

GET {{httpUrl}}/
Accept: application/json

### Get OpenAPI Specification
GET {{baseUrl}}/openapi/v1.json
Accept: application/json

###############################################
# Protected Endpoints (Add JWT token to test)
###############################################

### Example Protected Request
# Replace @token with actual JWT token from registration/login response
GET {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}
Accept: application/json
